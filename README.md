# Go Generators

A collection of code generators for Go projects.

## Installation

Install all generators:

```bash
go install github.com/goliatone/go-generators/cmd/...@latest
```

Or install specific generators:

```bash
go install github.com/goliatone/go-generators/cmd/options-setters@latest
```

## Usage

1. Install the generators you need
2. Add appropriate `//go:generate` comments to your code
3. Run `go generate ./...` in your project


## Available Generators

### Configuration Setters

Configuration Setters is a generator that scans a given Go file for existing functional options (like `func WithTimeout(...) Option`) and automatically creates "setter" interfaces and methods in a new file.

This lets you pass configuration data from a struct that implements the generated "getter" interfaces into your codeâ€™s functional options.

By integrating options-setters via a `//go:generate` directive, you can keep your code base clean, consistent, and easily configurable across different packages or modules.

1. Add a generate comment to your options file:

```go
//go:generate options-setters -input ./options.go -package yourpackage
```

2. Run go generate:

```bash
go generate ./...
```

Or run the generator directly:

```bash
options-setters -input ./options.go -package yourpackage
```

#### Options

- `-input`: Input file containing the options (default: options.go)
- `-output`: Output file for generated code (default: {input}_setters.go)
- `-package`: Package name for generated code (default: derived from input file)

#### Example

Given the following `options.go` file:

```go
package myapp

import (
	"context"
	"time"
)

type Option func(*Config)

func WithTimeout(d time.Duration) Option {
	return func(c *Config) {
		c.timeout = d
	}
}

func WithContext(ctx context.Context) Option {
	return func(c *Config) {
		c.ctx = ctx
	}
}

func WithHandler(h func(error) bool) Option {
	return func(c *Config) {
		c.handler = h
	}
}
```

Generated code:

```go
// Code generated by options-setters; DO NOT EDIT.

package myapp

type TimeoutGetter interface {
	GetTimeout() time.Duration
}

func WithTimeoutSetter(s TimeoutGetter) Option {
	return func(cs *Config) {
		if s != nil {
			cs.timeout = s.GetTimeout()
		}
	}
}

type ContextGetter interface {
	GetContext() context.Context
}

func WithContextSetter(s ContextGetter) Option {
	return func(cs *Config) {
		if s != nil {
			cs.ctx = s.GetContext()
		}
	}
}

type HandlerGetter interface {
	GetHandler() func(error) bool
}

func WithHandlerSetter(s HandlerGetter) Option {
	return func(cs *Config) {
		if s != nil {
			cs.handler = s.GetHandler()
		}
	}
}

// WithConfigurator sets multiple options from
// a single configuration struct that implements
// one or more Getter interfaces
func WithConfigurator(i interface{}) Option {
	return func(cs *Config) {

		if s, ok := i.(TimeoutGetter); ok {
			cs.timeout = s.GetTimeout()
		}

		if s, ok := i.(ContextGetter); ok {
			cs.ctx = s.GetContext()
		}

		if s, ok := i.(HandlerGetter); ok {
			cs.handler = s.GetHandler()
		}

	}
}
```
